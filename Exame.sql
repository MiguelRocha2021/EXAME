create table item(
    item varchar2(25) not null,
    dept number(4) not null,
    item_desc varchar2(25) not null
);

create table loc(
    loc number(10) not null,
    loc_desc varchar2(25) not null
);

create table item_loc_soh(
item varchar2(25) not null,
loc number(10) not null,
dept number(4) not null,
unit_cost number(20,4) not null,
stock_on_hand number(12,4) not null
);


--- in average this will take 1s to be executed
insert into item(item,dept,item_desc)
select level, round(DBMS_RANDOM.value(1,100)), translate(dbms_random.string('a', 20), 'abcXYZ', level) from dual connect by level <= 10000;

--- in average this will take 1s to be executed
insert into loc(loc,loc_desc)
select level+100, translate(dbms_random.string('a', 20), 'abcXYZ', level) from dual connect by level <= 1000;


/*delete from item_loc_soh;*/
-- in average this will take less than 120s to be executed
insert into item_loc_soh (item, loc, dept, unit_cost, stock_on_hand)
select item, loc, dept, (DBMS_RANDOM.value(5000,50000)), round(DBMS_RANDOM.value(1000,100000))
from item, loc
FETCH FIRST 100000 ROWS ONLY;

commit;



/* 1 -> Primary key definition and any other constraint or index suggestion */

/*Define tables primary keys */
ALTER TABLE item ADD CONSTRAINT item_pk PRIMARY KEY (item);
ALTER TABLE loc ADD CONSTRAINT loc_pk PRIMARY KEY (loc);
ALTER TABLE item_loc_soh ADD CONSTRAINT item_loc_soh_pk PRIMARY KEY (item, loc, dept);

/* Criação indices 
one of the attributes that most store/warehouse users search is by dept */
CREATE INDEX item_dept_idx ON item (dept);
CREATE INDEX item_loc_soh_dept_idx ON item_loc_soh (dept);


/*There are relational tables we have to create Foreign Key Constraints ,defined to maintain data integrity and optimize query performance
Foreign Key Constraints*/
ALTER TABLE item_loc_soh  ADD CONSTRAINT item_loc_soh_item_fk FOREIGN KEY (item) REFERENCES item (item);
ALTER TABLE item_loc_soh ADD CONSTRAINT item_loc_soh_loc_fk FOREIGN KEY (loc) REFERENCES loc (loc);



/*2 -> Your suggestion for table data management and data access considering the application usage
3 - Your suggestion to avoid row contention at table level parameter because of high level of concurrency */

/*Partitioning the "item_loc_soh" table based on the store/warehouse.*/
--select min(loc) min_id, max(loc) max_id from loc;	

ALTER TABLE item_loc_soh
    MODIFY
    PARTITION BY RANGE (loc)
    (
 PARTITION partition1 VALUES (100),
 PARTITION partition2 VALUES (101),
 PARTITION partition3 VALUES (102),
 PARTITION partition4 VALUES (103),
 PARTITION partition5 VALUES (104),
 PARTITION partition6 VALUES (105),
 PARTITION partition7 VALUES (106),
 PARTITION partition8 VALUES (107),
 PARTITION partition9 VALUES (108),
 PARTITION partition10 VALUES (109),
 PARTITION partition11 VALUES (110),
 PARTITION partition12 VALUES (111),
 PARTITION partition13 VALUES (112),
 PARTITION partition14 VALUES (113),
 PARTITION partition15 VALUES (114),
 PARTITION partition16 VALUES (115),
 PARTITION partition17 VALUES (116),
 PARTITION partition18 VALUES (117),
 PARTITION partition19 VALUES (118),
 PARTITION partition20 VALUES (119),
 PARTITION partition21 VALUES (120),
 PARTITION partition22 VALUES (121),
 PARTITION partition23 VALUES (122),
 PARTITION partition24 VALUES (123),
 PARTITION partition25 VALUES (124),
 PARTITION partition26 VALUES (125),
 PARTITION partition27 VALUES (126),
 PARTITION partition28 VALUES (127),
 PARTITION partition29 VALUES (128),
 PARTITION partition30 VALUES (129),
 PARTITION partition31 VALUES (130),
 PARTITION partition32 VALUES (131),
 PARTITION partition33 VALUES (132),
 PARTITION partition34 VALUES (133),
 PARTITION partition35 VALUES (134),
 PARTITION partition36 VALUES (135),
 PARTITION partition37 VALUES (136),
 PARTITION partition38 VALUES (137),
 PARTITION partition39 VALUES (138),
 PARTITION partition40 VALUES (139),
 PARTITION partition41 VALUES (140),
 PARTITION partition42 VALUES (141),
 PARTITION partition43 VALUES (142),
 PARTITION partition44 VALUES (143),
 PARTITION partition45 VALUES (144),
 PARTITION partition46 VALUES (145),
 PARTITION partition47 VALUES (146),
 PARTITION partition48 VALUES (147),
 PARTITION partition49 VALUES (148),
 PARTITION partition50 VALUES (149),
 PARTITION partition51 VALUES (150),
 PARTITION partition52 VALUES (151),
 PARTITION partition53 VALUES (152),
 PARTITION partition54 VALUES (153),
 PARTITION partition55 VALUES (154),
 PARTITION partition56 VALUES (155),
 PARTITION partition57 VALUES (156),
 PARTITION partition58 VALUES (157),
 PARTITION partition59 VALUES (158),
 PARTITION partition60 VALUES (159),
 PARTITION partition61 VALUES (160),
 PARTITION partition62 VALUES (161),
 PARTITION partition63 VALUES (162),
 PARTITION partition64 VALUES (163),
 PARTITION partition65 VALUES (164),
 PARTITION partition66 VALUES (165),
 PARTITION partition67 VALUES (166),
 PARTITION partition68 VALUES (167),
 PARTITION partition69 VALUES (168),
 PARTITION partition70 VALUES (169),
 PARTITION partition71 VALUES (170),
 PARTITION partition72 VALUES (171),
 PARTITION partition73 VALUES (172),
 PARTITION partition74 VALUES (173),
 PARTITION partition75 VALUES (174),
 PARTITION partition76 VALUES (175),
 PARTITION partition77 VALUES (176),
 PARTITION partition78 VALUES (177),
 PARTITION partition79 VALUES (178),
 PARTITION partition80 VALUES (179),
 PARTITION partition81 VALUES (180),
 PARTITION partition82 VALUES (181),
 PARTITION partition83 VALUES (182),
 PARTITION partition84 VALUES (183),
 PARTITION partition85 VALUES (184),
 PARTITION partition86 VALUES (185),
 PARTITION partition87 VALUES (186),
 PARTITION partition88 VALUES (187),
 PARTITION partition89 VALUES (188),
 PARTITION partition90 VALUES (189),
 PARTITION partition91 VALUES (190),
 PARTITION partition92 VALUES (191),
 PARTITION partition93 VALUES (192),
 PARTITION partition94 VALUES (193),
 PARTITION partition95 VALUES (194),
 PARTITION partition96 VALUES (195),
 PARTITION partition97 VALUES (196),
 PARTITION partition98 VALUES (197),
 PARTITION partition99 VALUES (198),
 PARTITION partition100 VALUES (199),
 PARTITION partition101 VALUES (200),
 PARTITION partition102 VALUES (201),
 PARTITION partition103 VALUES (202),
 PARTITION partition104 VALUES (203),
 PARTITION partition105 VALUES (204),
 PARTITION partition106 VALUES (205),
 PARTITION partition107 VALUES (206),
 PARTITION partition108 VALUES (207),
 PARTITION partition109 VALUES (208),
 PARTITION partition110 VALUES (209),
 PARTITION partition111 VALUES (210),
 PARTITION partition112 VALUES (211),
 PARTITION partition113 VALUES (212),
 PARTITION partition114 VALUES (213),
 PARTITION partition115 VALUES (214),
 PARTITION partition116 VALUES (215),
 PARTITION partition117 VALUES (216),
 PARTITION partition118 VALUES (217),
 PARTITION partition119 VALUES (218),
 PARTITION partition120 VALUES (219),
 PARTITION partition121 VALUES (220),
 PARTITION partition122 VALUES (221),
 PARTITION partition123 VALUES (222),
 PARTITION partition124 VALUES (223),
 PARTITION partition125 VALUES (224),
 PARTITION partition126 VALUES (225),
 PARTITION partition127 VALUES (226),
 PARTITION partition128 VALUES (227),
 PARTITION partition129 VALUES (228),
 PARTITION partition130 VALUES (229),
 PARTITION partition131 VALUES (230),
 PARTITION partition132 VALUES (231),
 PARTITION partition133 VALUES (232),
 PARTITION partition134 VALUES (233),
 PARTITION partition135 VALUES (234),
 PARTITION partition136 VALUES (235),
 PARTITION partition137 VALUES (236),
 PARTITION partition138 VALUES (237),
 PARTITION partition139 VALUES (238),
 PARTITION partition140 VALUES (239),
 PARTITION partition141 VALUES (240),
 PARTITION partition142 VALUES (241),
 PARTITION partition143 VALUES (242),
 PARTITION partition144 VALUES (243),
 PARTITION partition145 VALUES (244),
 PARTITION partition146 VALUES (245),
 PARTITION partition147 VALUES (246),
 PARTITION partition148 VALUES (247),
 PARTITION partition149 VALUES (248),
 PARTITION partition150 VALUES (249),
 PARTITION partition151 VALUES (250),
 PARTITION partition152 VALUES (251),
 PARTITION partition153 VALUES (252),
 PARTITION partition154 VALUES (253),
 PARTITION partition155 VALUES (254),
 PARTITION partition156 VALUES (255),
 PARTITION partition157 VALUES (256),
 PARTITION partition158 VALUES (257),
 PARTITION partition159 VALUES (258),
 PARTITION partition160 VALUES (259),
 PARTITION partition161 VALUES (260),
 PARTITION partition162 VALUES (261),
 PARTITION partition163 VALUES (262),
 PARTITION partition164 VALUES (263),
 PARTITION partition165 VALUES (264),
 PARTITION partition166 VALUES (265),
 PARTITION partition167 VALUES (266),
 PARTITION partition168 VALUES (267),
 PARTITION partition169 VALUES (268),
 PARTITION partition170 VALUES (269),
 PARTITION partition171 VALUES (270),
 PARTITION partition172 VALUES (271),
 PARTITION partition173 VALUES (272),
 PARTITION partition174 VALUES (273),
 PARTITION partition175 VALUES (274),
 PARTITION partition176 VALUES (275),
 PARTITION partition177 VALUES (276),
 PARTITION partition178 VALUES (277),
 PARTITION partition179 VALUES (278),
 PARTITION partition180 VALUES (279),
 PARTITION partition181 VALUES (280),
 PARTITION partition182 VALUES (281),
 PARTITION partition183 VALUES (282),
 PARTITION partition184 VALUES (283),
 PARTITION partition185 VALUES (284),
 PARTITION partition186 VALUES (285),
 PARTITION partition187 VALUES (286),
 PARTITION partition188 VALUES (287),
 PARTITION partition189 VALUES (288),
 PARTITION partition190 VALUES (289),
 PARTITION partition191 VALUES (290),
 PARTITION partition192 VALUES (291),
 PARTITION partition193 VALUES (292),
 PARTITION partition194 VALUES (293),
 PARTITION partition195 VALUES (294),
 PARTITION partition196 VALUES (295),
 PARTITION partition197 VALUES (296),
 PARTITION partition198 VALUES (297),
 PARTITION partition199 VALUES (298),
 PARTITION partition200 VALUES (299),
 PARTITION partition201 VALUES (300),
 PARTITION partition202 VALUES (301),
 PARTITION partition203 VALUES (302),
 PARTITION partition204 VALUES (303),
 PARTITION partition205 VALUES (304),
 PARTITION partition206 VALUES (305),
 PARTITION partition207 VALUES (306),
 PARTITION partition208 VALUES (307),
 PARTITION partition209 VALUES (308),
 PARTITION partition210 VALUES (309),
 PARTITION partition211 VALUES (310),
 PARTITION partition212 VALUES (311),
 PARTITION partition213 VALUES (312),
 PARTITION partition214 VALUES (313),
 PARTITION partition215 VALUES (314),
 PARTITION partition216 VALUES (315),
 PARTITION partition217 VALUES (316),
 PARTITION partition218 VALUES (317),
 PARTITION partition219 VALUES (318),
 PARTITION partition220 VALUES (319),
 PARTITION partition221 VALUES (320),
 PARTITION partition222 VALUES (321),
 PARTITION partition223 VALUES (322),
 PARTITION partition224 VALUES (323),
 PARTITION partition225 VALUES (324),
 PARTITION partition226 VALUES (325),
 PARTITION partition227 VALUES (326),
 PARTITION partition228 VALUES (327),
 PARTITION partition229 VALUES (328),
 PARTITION partition230 VALUES (329),
 PARTITION partition231 VALUES (330),
 PARTITION partition232 VALUES (331),
 PARTITION partition233 VALUES (332),
 PARTITION partition234 VALUES (333),
 PARTITION partition235 VALUES (334),
 PARTITION partition236 VALUES (335),
 PARTITION partition237 VALUES (336),
 PARTITION partition238 VALUES (337),
 PARTITION partition239 VALUES (338),
 PARTITION partition240 VALUES (339),
 PARTITION partition241 VALUES (340),
 PARTITION partition242 VALUES (341),
 PARTITION partition243 VALUES (342),
 PARTITION partition244 VALUES (343),
 PARTITION partition245 VALUES (344),
 PARTITION partition246 VALUES (345),
 PARTITION partition247 VALUES (346),
 PARTITION partition248 VALUES (347),
 PARTITION partition249 VALUES (348),
 PARTITION partition250 VALUES (349),
 PARTITION partition251 VALUES (350),
 PARTITION partition252 VALUES (351),
 PARTITION partition253 VALUES (352),
 PARTITION partition254 VALUES (353),
 PARTITION partition255 VALUES (354),
 PARTITION partition256 VALUES (355),
 PARTITION partition257 VALUES (356),
 PARTITION partition258 VALUES (357),
 PARTITION partition259 VALUES (358),
 PARTITION partition260 VALUES (359),
 PARTITION partition261 VALUES (360),
 PARTITION partition262 VALUES (361),
 PARTITION partition263 VALUES (362),
 PARTITION partition264 VALUES (363),
 PARTITION partition265 VALUES (364),
 PARTITION partition266 VALUES (365),
 PARTITION partition267 VALUES (366),
 PARTITION partition268 VALUES (367),
 PARTITION partition269 VALUES (368),
 PARTITION partition270 VALUES (369),
 PARTITION partition271 VALUES (370),
 PARTITION partition272 VALUES (371),
 PARTITION partition273 VALUES (372),
 PARTITION partition274 VALUES (373),
 PARTITION partition275 VALUES (374),
 PARTITION partition276 VALUES (375),
 PARTITION partition277 VALUES (376),
 PARTITION partition278 VALUES (377),
 PARTITION partition279 VALUES (378),
 PARTITION partition280 VALUES (379),
 PARTITION partition281 VALUES (380),
 PARTITION partition282 VALUES (381),
 PARTITION partition283 VALUES (382),
 PARTITION partition284 VALUES (383),
 PARTITION partition285 VALUES (384),
 PARTITION partition286 VALUES (385),
 PARTITION partition287 VALUES (386),
 PARTITION partition288 VALUES (387),
 PARTITION partition289 VALUES (388),
 PARTITION partition290 VALUES (389),
 PARTITION partition291 VALUES (390),
 PARTITION partition292 VALUES (391),
 PARTITION partition293 VALUES (392),
 PARTITION partition294 VALUES (393),
 PARTITION partition295 VALUES (394),
 PARTITION partition296 VALUES (395),
 PARTITION partition297 VALUES (396),
 PARTITION partition298 VALUES (397),
 PARTITION partition299 VALUES (398),
 PARTITION partition300 VALUES (399),
 PARTITION partition301 VALUES (400),
 PARTITION partition302 VALUES (401),
 PARTITION partition303 VALUES (402),
 PARTITION partition304 VALUES (403),
 PARTITION partition305 VALUES (404),
 PARTITION partition306 VALUES (405),
 PARTITION partition307 VALUES (406),
 PARTITION partition308 VALUES (407),
 PARTITION partition309 VALUES (408),
 PARTITION partition310 VALUES (409),
 PARTITION partition311 VALUES (410),
 PARTITION partition312 VALUES (411),
 PARTITION partition313 VALUES (412),
 PARTITION partition314 VALUES (413),
 PARTITION partition315 VALUES (414),
 PARTITION partition316 VALUES (415),
 PARTITION partition317 VALUES (416),
 PARTITION partition318 VALUES (417),
 PARTITION partition319 VALUES (418),
 PARTITION partition320 VALUES (419),
 PARTITION partition321 VALUES (420),
 PARTITION partition322 VALUES (421),
 PARTITION partition323 VALUES (422),
 PARTITION partition324 VALUES (423),
 PARTITION partition325 VALUES (424),
 PARTITION partition326 VALUES (425),
 PARTITION partition327 VALUES (426),
 PARTITION partition328 VALUES (427),
 PARTITION partition329 VALUES (428),
 PARTITION partition330 VALUES (429),
 PARTITION partition331 VALUES (430),
 PARTITION partition332 VALUES (431),
 PARTITION partition333 VALUES (432),
 PARTITION partition334 VALUES (433),
 PARTITION partition335 VALUES (434),
 PARTITION partition336 VALUES (435),
 PARTITION partition337 VALUES (436),
 PARTITION partition338 VALUES (437),
 PARTITION partition339 VALUES (438),
 PARTITION partition340 VALUES (439),
 PARTITION partition341 VALUES (440),
 PARTITION partition342 VALUES (441),
 PARTITION partition343 VALUES (442),
 PARTITION partition344 VALUES (443),
 PARTITION partition345 VALUES (444),
 PARTITION partition346 VALUES (445),
 PARTITION partition347 VALUES (446),
 PARTITION partition348 VALUES (447),
 PARTITION partition349 VALUES (448),
 PARTITION partition350 VALUES (449),
 PARTITION partition351 VALUES (450),
 PARTITION partition352 VALUES (451),
 PARTITION partition353 VALUES (452),
 PARTITION partition354 VALUES (453),
 PARTITION partition355 VALUES (454),
 PARTITION partition356 VALUES (455),
 PARTITION partition357 VALUES (456),
 PARTITION partition358 VALUES (457),
 PARTITION partition359 VALUES (458),
 PARTITION partition360 VALUES (459),
 PARTITION partition361 VALUES (460),
 PARTITION partition362 VALUES (461),
 PARTITION partition363 VALUES (462),
 PARTITION partition364 VALUES (463),
 PARTITION partition365 VALUES (464),
 PARTITION partition366 VALUES (465),
 PARTITION partition367 VALUES (466),
 PARTITION partition368 VALUES (467),
 PARTITION partition369 VALUES (468),
 PARTITION partition370 VALUES (469),
 PARTITION partition371 VALUES (470),
 PARTITION partition372 VALUES (471),
 PARTITION partition373 VALUES (472),
 PARTITION partition374 VALUES (473),
 PARTITION partition375 VALUES (474),
 PARTITION partition376 VALUES (475),
 PARTITION partition377 VALUES (476),
 PARTITION partition378 VALUES (477),
 PARTITION partition379 VALUES (478),
 PARTITION partition380 VALUES (479),
 PARTITION partition381 VALUES (480),
 PARTITION partition382 VALUES (481),
 PARTITION partition383 VALUES (482),
 PARTITION partition384 VALUES (483),
 PARTITION partition385 VALUES (484),
 PARTITION partition386 VALUES (485),
 PARTITION partition387 VALUES (486),
 PARTITION partition388 VALUES (487),
 PARTITION partition389 VALUES (488),
 PARTITION partition390 VALUES (489),
 PARTITION partition391 VALUES (490),
 PARTITION partition392 VALUES (491),
 PARTITION partition393 VALUES (492),
 PARTITION partition394 VALUES (493),
 PARTITION partition395 VALUES (494),
 PARTITION partition396 VALUES (495),
 PARTITION partition397 VALUES (496),
 PARTITION partition398 VALUES (497),
 PARTITION partition399 VALUES (498),
 PARTITION partition400 VALUES (499),
 PARTITION partition401 VALUES (500),
 PARTITION partition402 VALUES (501),
 PARTITION partition403 VALUES (502),
 PARTITION partition404 VALUES (503),
 PARTITION partition405 VALUES (504),
 PARTITION partition406 VALUES (505),
 PARTITION partition407 VALUES (506),
 PARTITION partition408 VALUES (507),
 PARTITION partition409 VALUES (508),
 PARTITION partition410 VALUES (509),
 PARTITION partition411 VALUES (510),
 PARTITION partition412 VALUES (511),
 PARTITION partition413 VALUES (512),
 PARTITION partition414 VALUES (513),
 PARTITION partition415 VALUES (514),
 PARTITION partition416 VALUES (515),
 PARTITION partition417 VALUES (516),
 PARTITION partition418 VALUES (517),
 PARTITION partition419 VALUES (518),
 PARTITION partition420 VALUES (519),
 PARTITION partition421 VALUES (520),
 PARTITION partition422 VALUES (521),
 PARTITION partition423 VALUES (522),
 PARTITION partition424 VALUES (523),
 PARTITION partition425 VALUES (524),
 PARTITION partition426 VALUES (525),
 PARTITION partition427 VALUES (526),
 PARTITION partition428 VALUES (527),
 PARTITION partition429 VALUES (528),
 PARTITION partition430 VALUES (529),
 PARTITION partition431 VALUES (530),
 PARTITION partition432 VALUES (531),
 PARTITION partition433 VALUES (532),
 PARTITION partition434 VALUES (533),
 PARTITION partition435 VALUES (534),
 PARTITION partition436 VALUES (535),
 PARTITION partition437 VALUES (536),
 PARTITION partition438 VALUES (537),
 PARTITION partition439 VALUES (538),
 PARTITION partition440 VALUES (539),
 PARTITION partition441 VALUES (540),
 PARTITION partition442 VALUES (541),
 PARTITION partition443 VALUES (542),
 PARTITION partition444 VALUES (543),
 PARTITION partition445 VALUES (544),
 PARTITION partition446 VALUES (545),
 PARTITION partition447 VALUES (546),
 PARTITION partition448 VALUES (547),
 PARTITION partition449 VALUES (548),
 PARTITION partition450 VALUES (549),
 PARTITION partition451 VALUES (550),
 PARTITION partition452 VALUES (551),
 PARTITION partition453 VALUES (552),
 PARTITION partition454 VALUES (553),
 PARTITION partition455 VALUES (554),
 PARTITION partition456 VALUES (555),
 PARTITION partition457 VALUES (556),
 PARTITION partition458 VALUES (557),
 PARTITION partition459 VALUES (558),
 PARTITION partition460 VALUES (559),
 PARTITION partition461 VALUES (560),
 PARTITION partition462 VALUES (561),
 PARTITION partition463 VALUES (562),
 PARTITION partition464 VALUES (563),
 PARTITION partition465 VALUES (564),
 PARTITION partition466 VALUES (565),
 PARTITION partition467 VALUES (566),
 PARTITION partition468 VALUES (567),
 PARTITION partition469 VALUES (568),
 PARTITION partition470 VALUES (569),
 PARTITION partition471 VALUES (570),
 PARTITION partition472 VALUES (571),
 PARTITION partition473 VALUES (572),
 PARTITION partition474 VALUES (573),
 PARTITION partition475 VALUES (574),
 PARTITION partition476 VALUES (575),
 PARTITION partition477 VALUES (576),
 PARTITION partition478 VALUES (577),
 PARTITION partition479 VALUES (578),
 PARTITION partition480 VALUES (579),
 PARTITION partition481 VALUES (580),
 PARTITION partition482 VALUES (581),
 PARTITION partition483 VALUES (582),
 PARTITION partition484 VALUES (583),
 PARTITION partition485 VALUES (584),
 PARTITION partition486 VALUES (585),
 PARTITION partition487 VALUES (586),
 PARTITION partition488 VALUES (587),
 PARTITION partition489 VALUES (588),
 PARTITION partition490 VALUES (589),
 PARTITION partition491 VALUES (590),
 PARTITION partition492 VALUES (591),
 PARTITION partition493 VALUES (592),
 PARTITION partition494 VALUES (593),
 PARTITION partition495 VALUES (594),
 PARTITION partition496 VALUES (595),
 PARTITION partition497 VALUES (596),
 PARTITION partition498 VALUES (597),
 PARTITION partition499 VALUES (598),
 PARTITION partition500 VALUES (599),
 PARTITION partition501 VALUES (600),
 PARTITION partition502 VALUES (601),
 PARTITION partition503 VALUES (602),
 PARTITION partition504 VALUES (603),
 PARTITION partition505 VALUES (604),
 PARTITION partition506 VALUES (605),
 PARTITION partition507 VALUES (606),
 PARTITION partition508 VALUES (607),
 PARTITION partition509 VALUES (608),
 PARTITION partition510 VALUES (609),
 PARTITION partition511 VALUES (610),
 PARTITION partition512 VALUES (611),
 PARTITION partition513 VALUES (612),
 PARTITION partition514 VALUES (613),
 PARTITION partition515 VALUES (614),
 PARTITION partition516 VALUES (615),
 PARTITION partition517 VALUES (616),
 PARTITION partition518 VALUES (617),
 PARTITION partition519 VALUES (618),
 PARTITION partition520 VALUES (619),
 PARTITION partition521 VALUES (620),
 PARTITION partition522 VALUES (621),
 PARTITION partition523 VALUES (622),
 PARTITION partition524 VALUES (623),
 PARTITION partition525 VALUES (624),
 PARTITION partition526 VALUES (625),
 PARTITION partition527 VALUES (626),
 PARTITION partition528 VALUES (627),
 PARTITION partition529 VALUES (628),
 PARTITION partition530 VALUES (629),
 PARTITION partition531 VALUES (630),
 PARTITION partition532 VALUES (631),
 PARTITION partition533 VALUES (632),
 PARTITION partition534 VALUES (633),
 PARTITION partition535 VALUES (634),
 PARTITION partition536 VALUES (635),
 PARTITION partition537 VALUES (636),
 PARTITION partition538 VALUES (637),
 PARTITION partition539 VALUES (638),
 PARTITION partition540 VALUES (639),
 PARTITION partition541 VALUES (640),
 PARTITION partition542 VALUES (641),
 PARTITION partition543 VALUES (642),
 PARTITION partition544 VALUES (643),
 PARTITION partition545 VALUES (644),
 PARTITION partition546 VALUES (645),
 PARTITION partition547 VALUES (646),
 PARTITION partition548 VALUES (647),
 PARTITION partition549 VALUES (648),
 PARTITION partition550 VALUES (649),
 PARTITION partition551 VALUES (650),
 PARTITION partition552 VALUES (651),
 PARTITION partition553 VALUES (652),
 PARTITION partition554 VALUES (653),
 PARTITION partition555 VALUES (654),
 PARTITION partition556 VALUES (655),
 PARTITION partition557 VALUES (656),
 PARTITION partition558 VALUES (657),
 PARTITION partition559 VALUES (658),
 PARTITION partition560 VALUES (659),
 PARTITION partition561 VALUES (660),
 PARTITION partition562 VALUES (661),
 PARTITION partition563 VALUES (662),
 PARTITION partition564 VALUES (663),
 PARTITION partition565 VALUES (664),
 PARTITION partition566 VALUES (665),
 PARTITION partition567 VALUES (666),
 PARTITION partition568 VALUES (667),
 PARTITION partition569 VALUES (668),
 PARTITION partition570 VALUES (669),
 PARTITION partition571 VALUES (670),
 PARTITION partition572 VALUES (671),
 PARTITION partition573 VALUES (672),
 PARTITION partition574 VALUES (673),
 PARTITION partition575 VALUES (674),
 PARTITION partition576 VALUES (675),
 PARTITION partition577 VALUES (676),
 PARTITION partition578 VALUES (677),
 PARTITION partition579 VALUES (678),
 PARTITION partition580 VALUES (679),
 PARTITION partition581 VALUES (680),
 PARTITION partition582 VALUES (681),
 PARTITION partition583 VALUES (682),
 PARTITION partition584 VALUES (683),
 PARTITION partition585 VALUES (684),
 PARTITION partition586 VALUES (685),
 PARTITION partition587 VALUES (686),
 PARTITION partition588 VALUES (687),
 PARTITION partition589 VALUES (688),
 PARTITION partition590 VALUES (689),
 PARTITION partition591 VALUES (690),
 PARTITION partition592 VALUES (691),
 PARTITION partition593 VALUES (692),
 PARTITION partition594 VALUES (693),
 PARTITION partition595 VALUES (694),
 PARTITION partition596 VALUES (695),
 PARTITION partition597 VALUES (696),
 PARTITION partition598 VALUES (697),
 PARTITION partition599 VALUES (698),
 PARTITION partition600 VALUES (699),
 PARTITION partition601 VALUES (700),
 PARTITION partition602 VALUES (701),
 PARTITION partition603 VALUES (702),
 PARTITION partition604 VALUES (703),
 PARTITION partition605 VALUES (704),
 PARTITION partition606 VALUES (705),
 PARTITION partition607 VALUES (706),
 PARTITION partition608 VALUES (707),
 PARTITION partition609 VALUES (708),
 PARTITION partition610 VALUES (709),
 PARTITION partition611 VALUES (710),
 PARTITION partition612 VALUES (711),
 PARTITION partition613 VALUES (712),
 PARTITION partition614 VALUES (713),
 PARTITION partition615 VALUES (714),
 PARTITION partition616 VALUES (715),
 PARTITION partition617 VALUES (716),
 PARTITION partition618 VALUES (717),
 PARTITION partition619 VALUES (718),
 PARTITION partition620 VALUES (719),
 PARTITION partition621 VALUES (720),
 PARTITION partition622 VALUES (721),
 PARTITION partition623 VALUES (722),
 PARTITION partition624 VALUES (723),
 PARTITION partition625 VALUES (724),
 PARTITION partition626 VALUES (725),
 PARTITION partition627 VALUES (726),
 PARTITION partition628 VALUES (727),
 PARTITION partition629 VALUES (728),
 PARTITION partition630 VALUES (729),
 PARTITION partition631 VALUES (730),
 PARTITION partition632 VALUES (731),
 PARTITION partition633 VALUES (732),
 PARTITION partition634 VALUES (733),
 PARTITION partition635 VALUES (734),
 PARTITION partition636 VALUES (735),
 PARTITION partition637 VALUES (736),
 PARTITION partition638 VALUES (737),
 PARTITION partition639 VALUES (738),
 PARTITION partition640 VALUES (739),
 PARTITION partition641 VALUES (740),
 PARTITION partition642 VALUES (741),
 PARTITION partition643 VALUES (742),
 PARTITION partition644 VALUES (743),
 PARTITION partition645 VALUES (744),
 PARTITION partition646 VALUES (745),
 PARTITION partition647 VALUES (746),
 PARTITION partition648 VALUES (747),
 PARTITION partition649 VALUES (748),
 PARTITION partition650 VALUES (749),
 PARTITION partition651 VALUES (750),
 PARTITION partition652 VALUES (751),
 PARTITION partition653 VALUES (752),
 PARTITION partition654 VALUES (753),
 PARTITION partition655 VALUES (754),
 PARTITION partition656 VALUES (755),
 PARTITION partition657 VALUES (756),
 PARTITION partition658 VALUES (757),
 PARTITION partition659 VALUES (758),
 PARTITION partition660 VALUES (759),
 PARTITION partition661 VALUES (760),
 PARTITION partition662 VALUES (761),
 PARTITION partition663 VALUES (762),
 PARTITION partition664 VALUES (763),
 PARTITION partition665 VALUES (764),
 PARTITION partition666 VALUES (765),
 PARTITION partition667 VALUES (766),
 PARTITION partition668 VALUES (767),
 PARTITION partition669 VALUES (768),
 PARTITION partition670 VALUES (769),
 PARTITION partition671 VALUES (770),
 PARTITION partition672 VALUES (771),
 PARTITION partition673 VALUES (772),
 PARTITION partition674 VALUES (773),
 PARTITION partition675 VALUES (774),
 PARTITION partition676 VALUES (775),
 PARTITION partition677 VALUES (776),
 PARTITION partition678 VALUES (777),
 PARTITION partition679 VALUES (778),
 PARTITION partition680 VALUES (779),
 PARTITION partition681 VALUES (780),
 PARTITION partition682 VALUES (781),
 PARTITION partition683 VALUES (782),
 PARTITION partition684 VALUES (783),
 PARTITION partition685 VALUES (784),
 PARTITION partition686 VALUES (785),
 PARTITION partition687 VALUES (786),
 PARTITION partition688 VALUES (787),
 PARTITION partition689 VALUES (788),
 PARTITION partition690 VALUES (789),
 PARTITION partition691 VALUES (790),
 PARTITION partition692 VALUES (791),
 PARTITION partition693 VALUES (792),
 PARTITION partition694 VALUES (793),
 PARTITION partition695 VALUES (794),
 PARTITION partition696 VALUES (795),
 PARTITION partition697 VALUES (796),
 PARTITION partition698 VALUES (797),
 PARTITION partition699 VALUES (798),
 PARTITION partition700 VALUES (799),
 PARTITION partition701 VALUES (800),
 PARTITION partition702 VALUES (801),
 PARTITION partition703 VALUES (802),
 PARTITION partition704 VALUES (803),
 PARTITION partition705 VALUES (804),
 PARTITION partition706 VALUES (805),
 PARTITION partition707 VALUES (806),
 PARTITION partition708 VALUES (807),
 PARTITION partition709 VALUES (808),
 PARTITION partition710 VALUES (809),
 PARTITION partition711 VALUES (810),
 PARTITION partition712 VALUES (811),
 PARTITION partition713 VALUES (812),
 PARTITION partition714 VALUES (813),
 PARTITION partition715 VALUES (814),
 PARTITION partition716 VALUES (815),
 PARTITION partition717 VALUES (816),
 PARTITION partition718 VALUES (817),
 PARTITION partition719 VALUES (818),
 PARTITION partition720 VALUES (819),
 PARTITION partition721 VALUES (820),
 PARTITION partition722 VALUES (821),
 PARTITION partition723 VALUES (822),
 PARTITION partition724 VALUES (823),
 PARTITION partition725 VALUES (824),
 PARTITION partition726 VALUES (825),
 PARTITION partition727 VALUES (826),
 PARTITION partition728 VALUES (827),
 PARTITION partition729 VALUES (828),
 PARTITION partition730 VALUES (829),
 PARTITION partition731 VALUES (830),
 PARTITION partition732 VALUES (831),
 PARTITION partition733 VALUES (832),
 PARTITION partition734 VALUES (833),
 PARTITION partition735 VALUES (834),
 PARTITION partition736 VALUES (835),
 PARTITION partition737 VALUES (836),
 PARTITION partition738 VALUES (837),
 PARTITION partition739 VALUES (838),
 PARTITION partition740 VALUES (839),
 PARTITION partition741 VALUES (840),
 PARTITION partition742 VALUES (841),
 PARTITION partition743 VALUES (842),
 PARTITION partition744 VALUES (843),
 PARTITION partition745 VALUES (844),
 PARTITION partition746 VALUES (845),
 PARTITION partition747 VALUES (846),
 PARTITION partition748 VALUES (847),
 PARTITION partition749 VALUES (848),
 PARTITION partition750 VALUES (849),
 PARTITION partition751 VALUES (850),
 PARTITION partition752 VALUES (851),
 PARTITION partition753 VALUES (852),
 PARTITION partition754 VALUES (853),
 PARTITION partition755 VALUES (854),
 PARTITION partition756 VALUES (855),
 PARTITION partition757 VALUES (856),
 PARTITION partition758 VALUES (857),
 PARTITION partition759 VALUES (858),
 PARTITION partition760 VALUES (859),
 PARTITION partition761 VALUES (860),
 PARTITION partition762 VALUES (861),
 PARTITION partition763 VALUES (862),
 PARTITION partition764 VALUES (863),
 PARTITION partition765 VALUES (864),
 PARTITION partition766 VALUES (865),
 PARTITION partition767 VALUES (866),
 PARTITION partition768 VALUES (867),
 PARTITION partition769 VALUES (868),
 PARTITION partition770 VALUES (869),
 PARTITION partition771 VALUES (870),
 PARTITION partition772 VALUES (871),
 PARTITION partition773 VALUES (872),
 PARTITION partition774 VALUES (873),
 PARTITION partition775 VALUES (874),
 PARTITION partition776 VALUES (875),
 PARTITION partition777 VALUES (876),
 PARTITION partition778 VALUES (877),
 PARTITION partition779 VALUES (878),
 PARTITION partition780 VALUES (879),
 PARTITION partition781 VALUES (880),
 PARTITION partition782 VALUES (881),
 PARTITION partition783 VALUES (882),
 PARTITION partition784 VALUES (883),
 PARTITION partition785 VALUES (884),
 PARTITION partition786 VALUES (885),
 PARTITION partition787 VALUES (886),
 PARTITION partition788 VALUES (887),
 PARTITION partition789 VALUES (888),
 PARTITION partition790 VALUES (889),
 PARTITION partition791 VALUES (890),
 PARTITION partition792 VALUES (891),
 PARTITION partition793 VALUES (892),
 PARTITION partition794 VALUES (893),
 PARTITION partition795 VALUES (894),
 PARTITION partition796 VALUES (895),
 PARTITION partition797 VALUES (896),
 PARTITION partition798 VALUES (897),
 PARTITION partition799 VALUES (898),
 PARTITION partition800 VALUES (899),
 PARTITION partition801 VALUES (900),
 PARTITION partition802 VALUES (901),
 PARTITION partition803 VALUES (902),
 PARTITION partition804 VALUES (903),
 PARTITION partition805 VALUES (904),
 PARTITION partition806 VALUES (905),
 PARTITION partition807 VALUES (906),
 PARTITION partition808 VALUES (907),
 PARTITION partition809 VALUES (908),
 PARTITION partition810 VALUES (909),
 PARTITION partition811 VALUES (910),
 PARTITION partition812 VALUES (911),
 PARTITION partition813 VALUES (912),
 PARTITION partition814 VALUES (913),
 PARTITION partition815 VALUES (914),
 PARTITION partition816 VALUES (915),
 PARTITION partition817 VALUES (916),
 PARTITION partition818 VALUES (917),
 PARTITION partition819 VALUES (918),
 PARTITION partition820 VALUES (919),
 PARTITION partition821 VALUES (920),
 PARTITION partition822 VALUES (921),
 PARTITION partition823 VALUES (922),
 PARTITION partition824 VALUES (923),
 PARTITION partition825 VALUES (924),
 PARTITION partition826 VALUES (925),
 PARTITION partition827 VALUES (926),
 PARTITION partition828 VALUES (927),
 PARTITION partition829 VALUES (928),
 PARTITION partition830 VALUES (929),
 PARTITION partition831 VALUES (930),
 PARTITION partition832 VALUES (931),
 PARTITION partition833 VALUES (932),
 PARTITION partition834 VALUES (933),
 PARTITION partition835 VALUES (934),
 PARTITION partition836 VALUES (935),
 PARTITION partition837 VALUES (936),
 PARTITION partition838 VALUES (937),
 PARTITION partition839 VALUES (938),
 PARTITION partition840 VALUES (939),
 PARTITION partition841 VALUES (940),
 PARTITION partition842 VALUES (941),
 PARTITION partition843 VALUES (942),
 PARTITION partition844 VALUES (943),
 PARTITION partition845 VALUES (944),
 PARTITION partition846 VALUES (945),
 PARTITION partition847 VALUES (946),
 PARTITION partition848 VALUES (947),
 PARTITION partition849 VALUES (948),
 PARTITION partition850 VALUES (949),
 PARTITION partition851 VALUES (950),
 PARTITION partition852 VALUES (951),
 PARTITION partition853 VALUES (952),
 PARTITION partition854 VALUES (953),
 PARTITION partition855 VALUES (954),
 PARTITION partition856 VALUES (955),
 PARTITION partition857 VALUES (956),
 PARTITION partition858 VALUES (957),
 PARTITION partition859 VALUES (958),
 PARTITION partition860 VALUES (959),
 PARTITION partition861 VALUES (960),
 PARTITION partition862 VALUES (961),
 PARTITION partition863 VALUES (962),
 PARTITION partition864 VALUES (963),
 PARTITION partition865 VALUES (964),
 PARTITION partition866 VALUES (965),
 PARTITION partition867 VALUES (966),
 PARTITION partition868 VALUES (967),
 PARTITION partition869 VALUES (968),
 PARTITION partition870 VALUES (969),
 PARTITION partition871 VALUES (970),
 PARTITION partition872 VALUES (971),
 PARTITION partition873 VALUES (972),
 PARTITION partition874 VALUES (973),
 PARTITION partition875 VALUES (974),
 PARTITION partition876 VALUES (975),
 PARTITION partition877 VALUES (976),
 PARTITION partition878 VALUES (977),
 PARTITION partition879 VALUES (978),
 PARTITION partition880 VALUES (979),
 PARTITION partition881 VALUES (980),
 PARTITION partition882 VALUES (981),
 PARTITION partition883 VALUES (982),
 PARTITION partition884 VALUES (983),
 PARTITION partition885 VALUES (984),
 PARTITION partition886 VALUES (985),
 PARTITION partition887 VALUES (986),
 PARTITION partition888 VALUES (987),
 PARTITION partition889 VALUES (988),
 PARTITION partition890 VALUES (989),
 PARTITION partition891 VALUES (990),
 PARTITION partition892 VALUES (991),
 PARTITION partition893 VALUES (992),
 PARTITION partition894 VALUES (993),
 PARTITION partition895 VALUES (994),
 PARTITION partition896 VALUES (995),
 PARTITION partition897 VALUES (996),
 PARTITION partition898 VALUES (997),
 PARTITION partition899 VALUES (998),
 PARTITION partition900 VALUES (999),
 PARTITION partition901 VALUES (1000),
 PARTITION partition902 VALUES (1001),
 PARTITION partition903 VALUES (1002),
 PARTITION partition904 VALUES (1003),
 PARTITION partition905 VALUES (1004),
 PARTITION partition906 VALUES (1005),
 PARTITION partition907 VALUES (1006),
 PARTITION partition908 VALUES (1007),
 PARTITION partition909 VALUES (1008),
 PARTITION partition910 VALUES (1009),
 PARTITION partition911 VALUES (1010),
 PARTITION partition912 VALUES (1011),
 PARTITION partition913 VALUES (1012),
 PARTITION partition914 VALUES (1013),
 PARTITION partition915 VALUES (1014),
 PARTITION partition916 VALUES (1015),
 PARTITION partition917 VALUES (1016),
 PARTITION partition918 VALUES (1017),
 PARTITION partition919 VALUES (1018),
 PARTITION partition920 VALUES (1019),
 PARTITION partition921 VALUES (1020),
 PARTITION partition922 VALUES (1021),
 PARTITION partition923 VALUES (1022),
 PARTITION partition924 VALUES (1023),
 PARTITION partition925 VALUES (1024),
 PARTITION partition926 VALUES (1025),
 PARTITION partition927 VALUES (1026),
 PARTITION partition928 VALUES (1027),
 PARTITION partition929 VALUES (1028),
 PARTITION partition930 VALUES (1029),
 PARTITION partition931 VALUES (1030),
 PARTITION partition932 VALUES (1031),
 PARTITION partition933 VALUES (1032),
 PARTITION partition934 VALUES (1033),
 PARTITION partition935 VALUES (1034),
 PARTITION partition936 VALUES (1035),
 PARTITION partition937 VALUES (1036),
 PARTITION partition938 VALUES (1037),
 PARTITION partition939 VALUES (1038),
 PARTITION partition940 VALUES (1039),
 PARTITION partition941 VALUES (1040),
 PARTITION partition942 VALUES (1041),
 PARTITION partition943 VALUES (1042),
 PARTITION partition944 VALUES (1043),
 PARTITION partition945 VALUES (1044),
 PARTITION partition946 VALUES (1045),
 PARTITION partition947 VALUES (1046),
 PARTITION partition948 VALUES (1047),
 PARTITION partition949 VALUES (1048),
 PARTITION partition950 VALUES (1049),
 PARTITION partition951 VALUES (1050),
 PARTITION partition952 VALUES (1051),
 PARTITION partition953 VALUES (1052),
 PARTITION partition954 VALUES (1053),
 PARTITION partition955 VALUES (1054),
 PARTITION partition956 VALUES (1055),
 PARTITION partition957 VALUES (1056),
 PARTITION partition958 VALUES (1057),
 PARTITION partition959 VALUES (1058),
 PARTITION partition960 VALUES (1059),
 PARTITION partition961 VALUES (1060),
 PARTITION partition962 VALUES (1061),
 PARTITION partition963 VALUES (1062),
 PARTITION partition964 VALUES (1063),
 PARTITION partition965 VALUES (1064),
 PARTITION partition966 VALUES (1065),
 PARTITION partition967 VALUES (1066),
 PARTITION partition968 VALUES (1067),
 PARTITION partition969 VALUES (1068),
 PARTITION partition970 VALUES (1069),
 PARTITION partition971 VALUES (1070),
 PARTITION partition972 VALUES (1071),
 PARTITION partition973 VALUES (1072),
 PARTITION partition974 VALUES (1073),
 PARTITION partition975 VALUES (1074),
 PARTITION partition976 VALUES (1075),
 PARTITION partition977 VALUES (1076),
 PARTITION partition978 VALUES (1077),
 PARTITION partition979 VALUES (1078),
 PARTITION partition980 VALUES (1079),
 PARTITION partition981 VALUES (1080),
 PARTITION partition982 VALUES (1081),
 PARTITION partition983 VALUES (1082),
 PARTITION partition984 VALUES (1083),
 PARTITION partition985 VALUES (1084),
 PARTITION partition986 VALUES (1085),
 PARTITION partition987 VALUES (1086),
 PARTITION partition988 VALUES (1087),
 PARTITION partition989 VALUES (1088),
 PARTITION partition990 VALUES (1089),
 PARTITION partition991 VALUES (1090),
 PARTITION partition992 VALUES (1091),
 PARTITION partition993 VALUES (1092),
 PARTITION partition994 VALUES (1093),
 PARTITION partition995 VALUES (1094),
 PARTITION partition996 VALUES (1095),
 PARTITION partition997 VALUES (1096),
 PARTITION partition998 VALUES (1097),
 PARTITION partition999 VALUES (1098),
 PARTITION partition1000 VALUES (1099),
 PARTITION partition1001 VALUES (1100)
);



/*
Partition the tables based on relevant criteria;
Implement connection pooling to efficiently manage database connections. 
Implement caching mechanisms at the application level to reduce the frequency of database accesses
Analyze the query patterns and optimize the table indexes accordingly. 
*/


 /*4 - Create a view that can be used at screen level to show only the required fields*/

 CREATE or replace VIEW item_loc_view AS
        SELECT i.item, i.dept, i.item_desc, l.loc, l.loc_desc, ils.unit_cost, ils.stock_on_hand
            FROM item i
                JOIN loc l ON i.dept = l.loc
                JOIN item_loc_soh ils ON i.item = ils.item AND l.loc = ils.loc;



 /* 5 - Create a new table that associates user to existing dept(s) */
 /*Frist create table users*/
CREATE TABLE users (
    user_id INT NOT NULL PRIMARY KEY,
    username VARCHAR2(50) NOT NULL
  );



CREATE TABLE user_loc (
    user_id INT NOT NULL,
    loc INT NOT NULL,
    PRIMARY KEY (user_id, loc),
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (loc) REFERENCES loc(loc)
);

/* 6-  Create a package with procedure or function that can be invoked by store or all stores to save the item_loc_soh to a new table that will contain the same information plus the stock value per item/loc (unit_cost*stock_on_hand) */

        -- Create a new table to store the item/loc stock data
       CREATE TABLE item_loc_stock (
            item VARCHAR2(25) NOT NULL,
            loc NUMBER(10) NOT NULL,
            dept NUMBER(4) NOT NULL,
            unit_cost NUMBER(20, 4) NOT NULL,
            stock_on_hand NUMBER(12, 4) NOT NULL,
            stock_value NUMBER(20, 4),
            PRIMARY KEY (item, loc)
        );

CREATE OR REPLACE PACKAGE item_loc_stock_pkg AS
    PROCEDURE P_item_loc_stock;
END item_loc_stock_pkg;
/

CREATE OR REPLACE PACKAGE BODY item_loc_stock_pkg AS
    PROCEDURE P_item_loc_stock IS
    BEGIN

        
        -- Insert data into the new table with calculated stock value
        INSERT INTO item_loc_stock (item, loc, dept, unit_cost, stock_on_hand, stock_value)
        SELECT ils.item, ils.loc, ils.dept, ils.unit_cost, ils.stock_on_hand, ils.unit_cost * ils.stock_on_hand
        FROM item_loc_soh ils;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            -- Handle exceptions or log errors here
            RAISE;
    END P_item_loc_stock;
END item_loc_stock_pkg;
/

 /* 7 - Create a data filter mechanism that can be used at screen level to filter out the data that user can see accordingly to dept association (created previously) 
  Create a context 
 */ 
CREATE CONTEXT loc_filter_ctx USING loc_filter_pkg;


/*Create a procedure to set the department context for each user session
*/
CREATE OR REPLACE PACKAGE Loc_filter_pkg AS
    PROCEDURE set_user_loc_context(p_user_id INT);
END;
/

CREATE OR REPLACE PACKAGE BODY Loc_filter_pkg AS
 PROCEDURE set_user_loc_context(p_user_id INT) IS
    v_loc_id number:=0;
    BEGIN
        -- Retrieve the department information for the user from the user_dept table
           SELECT loc
            INTO v_loc_id
            FROM user_loc
            WHERE user_id = p_user_id;
         
        -- Set the department information in the session context
        DBMS_SESSION.SET_CONTEXT('loc_filter_ctx', 'loc', v_loc_id);
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            -- Handle the case when the user does not have any associated department
            DBMS_SESSION.SET_CONTEXT('dept_filter_ctx', 'loc', NULL);
        WHEN OTHERS THEN
            -- Handle exceptions or log errors here
            RAISE;
    END set_user_loc_context;

END Loc_filter_pkg;
/

/*Create a view that filters the data based on the user's loc */
CREATE OR REPLACE VIEW filtered_item_loc_view AS
SELECT ils.item, ils.loc, ils.dept, ils.unit_cost, ils.stock_on_hand
FROM item_loc_soh ils
WHERE ils.dept = SYS_CONTEXT('dept_filter_ctx', 'dept_id');


 /* 8 - Create a pipeline function to be used in the location list of values (drop down)
 */

/*Create a structure of the location information*/
CREATE OR REPLACE TYPE loc_type AS OBJECT (
    loc NUMBER(10),
    loc_desc VARCHAR2(25)
);
/

/*Create a type table of loc_type objects to hold the location */
CREATE OR REPLACE TYPE loc_table_type AS TABLE OF loc_type;
/

/*Create the pipeline function that retrieves the location  */
CREATE OR REPLACE FUNCTION get_location_list RETURN loc_table_type PIPELINED IS
    l_loc loc_type;
BEGIN
    FOR rec IN (SELECT loc, loc_desc FROM loc) LOOP
        l_loc := loc_type(rec.loc, rec.loc_desc);
        PIPE ROW(l_loc);
    END LOOP;

    RETURN;
END;
/

/*9 -> ooking into the following explain plan what should be your recommendation and implementation to improve the existing data model. Please share your solution and the corresponding explain plan. Please take in consideration the way that user will use the app*/



CREATE INDEX idx_item_loc_soh_loc ON ITEM_LOC_SOH (LOC);
CREATE INDEX idx_item_loc_soh_dept ON ITEM_LOC_SOH (DEPT);


BEGIN
  DBMS_STATS.GATHER_TABLE_STATS('your_schema', 'ITEM_LOC_SOH');
END;



/* 10 - Run the previous method that was created on 6. for all the stores from item_loc_soh to the history table. The entire migration should not take more than 15s to run (don't use parallel hint to solve it :)) */


/* 11 - Please have a look into the AWR report (AWR.html) in attachment and let us know what is the problem that the AWR is highlighting and potential solution. */


/* 12 - Create a program (plsql and/or java, or any other language) that can extract to a flat file (csv), 1 file per location: the item, department unit cost, stock on hand quantity and stock value.
Creating the 1000 files should take less than 30s.
*/

CREATE OR REPLACE PROCEDURE extract_data_to_csv(p_num_partitions IN NUMBER) AS
  CURSOR c_partitions IS
    SELECT partition_name
    FROM user_tab_partitions
    WHERE table_name = 'ITEM_LOC_SOH'
      AND ROWNUM = p_num_partitions;

  v_file UTL_FILE.FILE_TYPE;
  v_partition_name user_tab_partitions.partition_name%TYPE;
  v_item item_loc_soh.item%TYPE;
  v_dept item_loc_soh.dept%TYPE;
  v_unit_cost item_loc_soh.unit_cost%TYPE;
  v_stock_on_hand item_loc_soh.stock_on_hand%TYPE;
  v_stock_value NUMBER;
BEGIN
  FOR partition_rec IN c_partitions LOOP
    -- Open a new file for each partition
    v_file := UTL_FILE.FOPEN('DIRECTORY_PATH', 'partition_' || partition_rec.partition_name || '.csv', 'W');

    -- Write the CSV header
    UTL_FILE.PUT_LINE(v_file, 'Item,Department,Unit Cost,Stock on Hand,Stock Value');

    -- Fetch data for the current partition
    FOR data_rec IN (SELECT item, dept, unit_cost, stock_on_hand
                     FROM item_loc_soh PARTITION (partition_rec.partition_name)) LOOP
      -- Calculate the stock value
      v_stock_value := data_rec.unit_cost * data_rec.stock_on_hand;

      -- Write the data to the file
      UTL_FILE.PUT_LINE(v_file, data_rec.item || ',' || data_rec.dept || ',' || data_rec.unit_cost || ',' ||
                                   data_rec.stock_on_hand || ',' || v_stock_value);
    END LOOP;

    -- Close the file
    UTL_FILE.FCLOSE(v_file);
  END LOOP;
END;
/


/*Java Program */
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class ExtractDataToCsvProgram {
    private static final String DB_URL = "Connection String";
    private static final String DB_USERNAME = "your_username";
    private static final String DB_PASSWORD = "your_password";

    private static final String PROCEDURE_CALL = "extract_data_to_csv";

    public static void main(String[] args) {
        try {
            // Load Oracle JDBC driver
            Class.forName("oracle.jdbc.OracleDriver");

            // Create a connection to the database
            Connection connection = DriverManager.getConnection(DB_URL, DB_USERNAME, DB_PASSWORD);

            // Create a prepared statement for the procedure call
            PreparedStatement statement = connection.prepareStatement(PROCEDURE_CALL);

            // Execute the procedure call for partitions 1 to 1000 in separate threads
            int numPartitions = 1000;
            for (int i = 1; i <= numPartitions; i++) {
                final int partitionNumber = i;
                Thread thread = new Thread(() -> executeProcedure(statement, partitionNumber));
                thread.start();
            }

            // Wait for all threads to finish
            Thread.sleep(300); // Adjust as needed

            // Close the statement and connection
            statement.close();
            connection.close();
        } catch (ClassNotFoundException | SQLException | InterruptedException e) {
            e.printStackTrace();
        }
    }

    private static void executeProcedure(PreparedStatement statement, int partitionNumber) {
        try {
            // Set the partition number as the parameter value
            statement.setInt(1, partitionNumber);

            // Execute the procedure call
            statement.execute();

            System.out.println("Procedure executed for partition: " + partitionNumber);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}


*/








